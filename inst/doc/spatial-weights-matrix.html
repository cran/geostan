<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />


<meta name="date" content="2021-09-13" />

<title>Spatial weights matrix</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>
<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Spatial weights matrix</h1>
<h4 class="date">September 13, 2021</h4>


<div id="TOC">
<ul>
<li><a href="#getting-started"><span class="toc-section-number">0.1</span> Getting started</a></li>
<li><a href="#contiguity"><span class="toc-section-number">0.2</span> Contiguity</a></li>
<li><a href="#visualizing-connectivity"><span class="toc-section-number">0.3</span> Visualizing connectivity</a></li>
<li><a href="#k-nearest-neighbors"><span class="toc-section-number">0.4</span> K-nearest neighbors</a></li>
<li><a href="#row-standardized-matrix"><span class="toc-section-number">0.5</span> Row-standardized matrix</a></li>
<li><a href="#editing-the-matrix"><span class="toc-section-number">0.6</span> Editing the matrix</a></li>
<li><a href="#using-the-matrix"><span class="toc-section-number">0.7</span> Using the matrix</a></li>
</ul>
</div>

<p>This vignette explains what a spatial weights matrix is, how to create one using geostan, and how to edit one manually when needed.</p>
<div id="getting-started" class="section level2" number="0.1">
<h2 number="0.1"><span class="header-section-number">0.1</span> Getting started</h2>
<p>Beyond the visual examination of maps, spatial data analysis requires a way of representing spatial contiguity or spatial order. This is usually done by storing a list of which areas are neighbors to one another. That is, for each observation, we will have a list identifying the neighboring areas. We store this information in an N-by-N matrix, which is known as an adjacency matrix, spatial connectivity matrix, or spatial weights matrix.</p>
<p>Getting this information into convenient format allows us to create summary statistics that describe spatial features of the data. Just like we can measure the degree of correlation between two variables (and create scatter plots to visualize it), we can measure the degree to which a variable is correlated with its own values over space. This is known as spatial autocorrelation (SA), or map pattern.</p>
<p>Our spatial weights matrix is going to enable us to measure and to visualize SA, and this means we have to be fairly thoughtful about how we create this matrix. However, there are only a small number of methods that are used very often, and simple techniques are often sufficient if not best.</p>
<p>To get started, load the geostan and sf packages:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">library</span>(geostan)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="kw">library</span>(sf)</span></code></pre></div>
</div>
<div id="contiguity" class="section level2" number="0.2">
<h2 number="0.2"><span class="header-section-number">0.2</span> Contiguity</h2>
<p>We may say that two areas are contiguous, or neighbors of one another, if they share a stretch of border. This is known as the ‘rook’ contiguity condition. Alternatively, we could allow for any shared point to count as a shared border; that is known as the ‘queen’ contiguity condition. (This is an analogy to chess moves.)</p>
<p>An example will illustrate the difference. Here is a simple grid:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="co"># create a regular grid</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>row =<span class="st"> </span>col =<span class="st"> </span><span class="dv">3</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>sfc =<span class="st"> </span><span class="kw">st_sfc</span>(<span class="kw">st_polygon</span>(<span class="kw">list</span>(<span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="kw">c</span>(col,<span class="dv">0</span>), <span class="kw">c</span>(col,row), <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)))))</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>grid &lt;-<span class="st"> </span><span class="kw">st_make_grid</span>(sfc, <span class="dt">cellsize =</span> <span class="dv">1</span>, <span class="dt">square =</span> <span class="ot">TRUE</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>grid &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(grid)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">4</span>))</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a><span class="kw">plot</span>( grid )</span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAVAAAAEgCAMAAADVFNsqAAAAOVBMVEUAAAABAQEPDw8REREqKiorKysyMjIzMzNiYmKqqqq2tra5ubnGxsbHx8fMzMzU1NTe3t7k5OT///+IunNdAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAC+ElEQVR4nO3dSU4DQRQFQRcGt23ABu5/WFawZVB8MShj3XpqpVS1rd1LqN1P/8B/U1CsoFhBsYJiBcUKihUUKyj2iaDHbcj+MLN72M/sbtuRBL07XWas88zuec3sXk53Juj142++ZT3P7D6vmd2Xa0GtgmIFxQqKFRQrKFZQrKBYQbGCYgXFCooVFCsoVlCsoFhBsYJiBcUKihUUKyhWUKygWEGxgmIFxQqKFRQrKFZQrKBYQbGCYgXFCooVFCsoVlCsoFhBsYJiBcUKihUUKyhWUKygWEGxgmIFxQqKFRQrKFZQrKBYQbGCYgXFCooVFCsoVlCsoFhBsYJiBcUKihUUKyhWUKygWEGxgmIFxQqKFRQrKFZQrKBYQbGCYgXFCooVFCsohoLerCG7Pzd8Q4Le3j/NWI8zu49rZvfp/pYE7ci/6Q7FCooVFCsoVlCsoFhBsYJiBcUKihUUKyhWUKygWEGxgmIFxQqKFRQrKFZQrKBYQbGCYgXFCooVFCsoVlCsoFhBsYJiBcUKihUUKyhWUKygWEGxgmIFxQqKFRQrKFZQrKBYQbGCYgXFCooVFCsoVlCsoFhBsYJiBcUKihUUKyhWUKygWEGxgmIFxQqKFRQrKFZQrKBYQbGCYgXFCooVFCsoVlCsoFhBsYJiBcUKihUUKyhWUAwF/XPPUD788mcoeyj1nXkotSP/pjsUKyhWUKygWEGxgmIFxQqKFRQrKFZQrKBYQbGCYgXFCooVFCsoVlCsoFhBsYJiBcUKihUUKyhWUKygWEGxgmIFxQqKFRQrKFZQrKBYQbGCYgXFCooVFCsoVlCsoFhBsYJiBcUKihUUKyhWUKygWEGxgmIFxQqKFRQrKFZQrKBYQbGCYgXFCooVFCsoVlCsoFhBsYJiBcUKihUUKyhWUKygWEGxgmIFxQqKFRQrKFZQrKBYQbGCYiro6TJjnWd2z2tm93IyQY/bkP1hZvewn9ndtiMJmq8oKFZQrKBYQbGCYgXFCooVFCso9grhwAgu5fuIRQAAAABJRU5ErkJggg==" style="display: block; margin: auto;" /></p>
<p>Using the rook criteria, we would say that the center square has four neighbors, one on every side. If we use the queen criteria, then we also add the corner squares, so it will have eight neighbors.</p>
<p>To create the spatial adjacency matrix for the grid, we pass it to the <code>geostan::shape2mat</code> function:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a>A &lt;-<span class="st"> </span><span class="kw">shape2mat</span>(grid, <span class="dt">method =</span> <span class="st">&#39;rook&#39;</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="co">#&gt; Contiguity condition: rook</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a><span class="co">#&gt; Number of neighbors per unit, summary:</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a><span class="co">#&gt;   2.000   2.000   3.000   2.667   3.000   4.000</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a><span class="co">#&gt; </span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a><span class="co">#&gt; Spatial weights, summary:</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a><span class="co">#&gt;       1       1       1       1       1       1</span></span></code></pre></div>
<p>Every spatial unit in our data will have its own row in the matrix; the first row in the matrix corresponds to the first row in the data. If the first observation is a neighbor to, say, the third one, then the element in the third column of the first row will be one; if they are not neighbors, the element will be zero.</p>
<p>The object <code>A</code> is a sparse matrix - that means that you can treat it like a matrix in calculations, but it is more efficient than a standard matrix. You can learn more by reading up on the Matrix package. (Sometimes you will need to use methods provided by the Matrix package; for example, instead of <code>colSums(A)</code> you may need to use <code>Matrix::colSums(A)</code>.)</p>
<p>The <code>geostan::n_nbs</code> function will tell us how many neighbors each area has (according to the adjacency matrix):</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="kw">n_nbs</span>(A)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a><span class="co">#&gt; [1] 2 3 2 3 4 3 2 3 2</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a><span class="kw">summary</span>( <span class="kw">n_nbs</span>(A) )</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a><span class="co">#&gt;   2.000   2.000   3.000   2.667   3.000   4.000</span></span></code></pre></div>
<p>And for the queen condition:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a>Aq &lt;-<span class="st"> </span><span class="kw">shape2mat</span>(grid, <span class="dt">method =</span> <span class="st">&#39;queen&#39;</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a><span class="co">#&gt; Contiguity condition: queen</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a><span class="co">#&gt; Number of neighbors per unit, summary:</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a><span class="co">#&gt;   3.000   3.000   5.000   4.444   5.000   8.000</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a><span class="co">#&gt; </span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a><span class="co">#&gt; Spatial weights, summary:</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true"></a><span class="co">#&gt;       1       1       1       1       1       1</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true"></a><span class="kw">n_nbs</span>(Aq)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true"></a><span class="co">#&gt; [1] 3 5 3 5 8 5 3 5 3</span></span></code></pre></div>
<p>Now the minimum number is three and the maximum, for the center square, is eight.</p>
</div>
<div id="visualizing-connectivity" class="section level2" number="0.3">
<h2 number="0.3"><span class="header-section-number">0.3</span> Visualizing connectivity</h2>
<p>It is always a good idea to visualize your connectivity matrix. These matrices are also graph structures - each area in the grid is a node and the connections are called edges.</p>
<p>The <code>geostan::edges</code> function converts a matrix to a data.frame which lists each pair of connected nodes. If we also provide <code>spatial = grid</code>, then it will return a simple features object that we can plot.</p>
<p>This code gets those connections as a simple features object and lays it over the grid:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="co"># geometry of the grid</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a>geom &lt;-<span class="st"> </span><span class="kw">st_geometry</span>(grid)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a><span class="co"># geometry of the graph</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a>edges &lt;-<span class="st"> </span><span class="kw">edges</span>(A, <span class="dt">shape =</span> grid)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true"></a>graph &lt;-<span class="st"> </span><span class="kw">st_geometry</span>(edges)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true"></a><span class="co"># plot overlay</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true"></a><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">4</span>))</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true"></a><span class="kw">plot</span>(geom, <span class="dt">lwd =</span> <span class="fl">.1</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true"></a><span class="kw">plot</span>(graph, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">type =</span> <span class="st">&#39;b&#39;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" style="display: block; margin: auto;" /></p>
<p>The units with the lowest number of neighbors are the corner squares (they have two neighbors each). The most connected unit is in the center, with 4 neighbors.</p>
<p>Now here is what the grid looks like using the queen contiguity condition:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a>Aq &lt;-<span class="st"> </span><span class="kw">shape2mat</span>(grid, <span class="dt">method =</span> <span class="st">&#39;queen&#39;</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a><span class="co">#&gt; Contiguity condition: queen</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a><span class="co">#&gt; Number of neighbors per unit, summary:</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true"></a><span class="co">#&gt;   3.000   3.000   5.000   4.444   5.000   8.000</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true"></a><span class="co">#&gt; </span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true"></a><span class="co">#&gt; Spatial weights, summary:</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true"></a><span class="co">#&gt;       1       1       1       1       1       1</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true"></a>E &lt;-<span class="st"> </span><span class="kw">edges</span>(Aq, <span class="dt">shape =</span> grid)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true"></a>graph &lt;-<span class="st"> </span><span class="kw">st_geometry</span>(E)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true"></a><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">4</span>))</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true"></a><span class="kw">plot</span>(geom, <span class="dt">lwd =</span> <span class="fl">.1</span>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true"></a><span class="kw">plot</span>(graph, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">type =</span> <span class="st">&#39;b&#39;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" style="display: block; margin: auto;" /></p>
</div>
<div id="k-nearest-neighbors" class="section level2" number="0.4">
<h2 number="0.4"><span class="header-section-number">0.4</span> K-nearest neighbors</h2>
<p>The queen and rook criteria are common when working with areal data (polygons). Another method, which also works for point data, is K nearest neighbors. If you use <code>k = 4</code>, then for each spatial unit, this method will identify the four nearest observations and classify them as neighbors to the first.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a>A4 &lt;-<span class="st"> </span><span class="kw">shape2mat</span>(grid, <span class="dt">method =</span> <span class="st">&#39;knn&#39;</span>, <span class="dt">k =</span> <span class="dv">4</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a><span class="co">#&gt; Warning in spdep::knearneigh(coords, k = k, longlat = longlat): k greater than</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a><span class="co">#&gt; one-third of the number of data points</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a><span class="co">#&gt; Contiguity condition: knn, k=4</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true"></a><span class="co">#&gt; Number of neighbors per unit, summary:</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true"></a><span class="co">#&gt;       4       4       4       4       4       4</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true"></a><span class="co">#&gt; </span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true"></a><span class="co">#&gt; Spatial weights, summary:</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true"></a><span class="co">#&gt;       1       1       1       1       1       1</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true"></a><span class="kw">n_nbs</span>(A4)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true"></a><span class="co">#&gt; [1] 4 4 4 4 4 4 4 4 4</span></span></code></pre></div>
<p>When applied to polygons, the function will first convert each polygon to a single point - its centroid - and then calculate pairwise distances between those points.</p>
</div>
<div id="row-standardized-matrix" class="section level2" number="0.5">
<h2 number="0.5"><span class="header-section-number">0.5</span> Row-standardized matrix</h2>
<p>Thus far, all of the matrices have been binary - the elements are all zeroes and ones. A common alternative is to row-standardize this matrix. In that case, if the first spatial unit has four neighbors, then each of those ones will be converted to 1/4 or <code>0.25</code> - they will sum to one. If the second row has five neighbors, then each one will be converted to <code>0.2</code>.</p>
<p>You can use the <code>geostan::row_standardize</code> function:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a>W &lt;-<span class="st"> </span><span class="kw">row_standardize</span>(A)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a><span class="co">#&gt; Row standardizing connectivity matrix</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a><span class="kw">print</span>( W )</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true"></a><span class="co">#&gt; 9 x 9 sparse Matrix of class &quot;dgCMatrix&quot;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true"></a><span class="co">#&gt;                                                                            </span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true"></a><span class="co">#&gt;  [1,] .         0.50 .         0.50 .         .    .         .    .        </span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true"></a><span class="co">#&gt;  [2,] 0.3333333 .    0.3333333 .    0.3333333 .    .         .    .        </span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true"></a><span class="co">#&gt;  [3,] .         0.50 .         .    .         0.50 .         .    .        </span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true"></a><span class="co">#&gt;  [4,] 0.3333333 .    .         .    0.3333333 .    0.3333333 .    .        </span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true"></a><span class="co">#&gt;  [5,] .         0.25 .         0.25 .         0.25 .         0.25 .        </span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true"></a><span class="co">#&gt;  [6,] .         .    0.3333333 .    0.3333333 .    .         .    0.3333333</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true"></a><span class="co">#&gt;  [7,] .         .    .         0.50 .         .    .         0.50 .        </span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true"></a><span class="co">#&gt;  [8,] .         .    .         .    0.3333333 .    0.3333333 .    0.3333333</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true"></a><span class="co">#&gt;  [9,] .         .    .         .    .         0.50 .         0.50 .</span></span></code></pre></div>
<p>Or you can use <code>style = &#39;W&#39;</code> with <code>shape2mat</code>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a>W &lt;-<span class="st"> </span><span class="kw">shape2mat</span>(grid, <span class="st">&#39;W&#39;</span>, <span class="dt">method =</span> <span class="st">&#39;rook&#39;</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a><span class="co">#&gt; Contiguity condition: rook</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a><span class="co">#&gt; Number of neighbors per unit, summary:</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true"></a><span class="co">#&gt;   2.000   2.000   3.000   2.667   3.000   4.000</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true"></a><span class="co">#&gt; </span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true"></a><span class="co">#&gt; Spatial weights, summary:</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true"></a><span class="co">#&gt;  0.2500  0.3333  0.3333  0.3750  0.5000  0.5000</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true"></a><span class="kw">print</span>( W )</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true"></a><span class="co">#&gt; 9 x 9 sparse Matrix of class &quot;dgCMatrix&quot;</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true"></a><span class="co">#&gt;                                                                            </span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true"></a><span class="co">#&gt;  [1,] .         0.50 .         0.50 .         .    .         .    .        </span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true"></a><span class="co">#&gt;  [2,] 0.3333333 .    0.3333333 .    0.3333333 .    .         .    .        </span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true"></a><span class="co">#&gt;  [3,] .         0.50 .         .    .         0.50 .         .    .        </span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true"></a><span class="co">#&gt;  [4,] 0.3333333 .    .         .    0.3333333 .    0.3333333 .    .        </span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true"></a><span class="co">#&gt;  [5,] .         0.25 .         0.25 .         0.25 .         0.25 .        </span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true"></a><span class="co">#&gt;  [6,] .         .    0.3333333 .    0.3333333 .    .         .    0.3333333</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true"></a><span class="co">#&gt;  [7,] .         .    .         0.50 .         .    .         0.50 .        </span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true"></a><span class="co">#&gt;  [8,] .         .    .         .    0.3333333 .    0.3333333 .    0.3333333</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true"></a><span class="co">#&gt;  [9,] .         .    .         .    .         0.50 .         0.50 .</span></span></code></pre></div>
</div>
<div id="editing-the-matrix" class="section level2" number="0.6">
<h2 number="0.6"><span class="header-section-number">0.6</span> Editing the matrix</h2>
<p>You should always check your adjacency matrix. Why? Because you may find something unexpected. There may be slight imperfections in the spatial boundary data, or actual gaps between nearby areas, that cause ‘neighboring’ areas to be missed. Or, strange shapes may cause two substantively ‘non-neighboring’ areas to be joined as neighbors.</p>
<p>To edit the matrix, you need to know the index position of the areas of interest (that is, which row corresponds to each polygon):</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a><span class="co"># row number, index position </span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a>Id &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(grid)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a><span class="co"># centroid coordinates (x, y)</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true"></a>coords &lt;-<span class="st"> </span><span class="kw">st_centroid</span>(grid)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true"></a>xy &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">unlist</span>(coords), <span class="dt">byrow =</span> T, <span class="dt">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true"></a><span class="co"># map Ids</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true"></a><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">4</span>))</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true"></a><span class="kw">plot</span>(geom, <span class="dt">lwd =</span> <span class="fl">.15</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true"></a><span class="kw">text</span>(<span class="dt">x =</span> xy[,<span class="dv">1</span>], <span class="dt">y =</span> xy[,<span class="dv">2</span>],</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true"></a>     <span class="dt">label =</span> Id)</span></code></pre></div>
<p><img src="data:image/png;base64,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" style="display: block; margin: auto;" /></p>
<p>(You could adjust that code to plot the number of neighbors each polygon has, which is another useful way to visualize connectivity.)</p>
<p>If, for whatever reason, we wanted to connect the second polygon to the fourth, we would need to change the elements of the fourth column in the second row, <code>A[2, 4]</code>, and the second column in the fourth row, <code>A[4, 2]</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a>A[<span class="dv">2</span>, <span class="dv">4</span>] &lt;-<span class="st"> </span>A[<span class="dv">4</span>, <span class="dv">2</span>] &lt;-<span class="st"> </span><span class="ot">TRUE</span> <span class="co"># 1</span></span></code></pre></div>
<p>If we wanted to remove the connection between the first and second polygon we would replace their ones with zeroes:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a>A[<span class="dv">1</span>, <span class="dv">2</span>] &lt;-<span class="st"> </span>A[<span class="dv">2</span>, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="ot">FALSE</span> <span class="co"># 0</span></span></code></pre></div>
<p>Notice that the above operations apply when the matrix is binary and symmetric. KNN is not symmetric. If you want or need to use row-standardization, be sure to finish editing the binary matrix and then row standardize it.</p>
</div>
<div id="using-the-matrix" class="section level2" number="0.7">
<h2 number="0.7"><span class="header-section-number">0.7</span> Using the matrix</h2>
<p>The matrix allows us to calculate the <em>spatial lag</em> of any observation - that is, a weighted sum of the neighboring values.</p>
<p>We can illustrate with some data:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a><span class="co"># draw data from spatial autoregressive model</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">101010</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true"></a>y &lt;-<span class="st"> </span><span class="kw">sim_sar</span>(<span class="dt">w =</span> W, <span class="dt">rho =</span> <span class="fl">.8</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true"></a><span class="kw">print</span>( y )</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true"></a><span class="co">#&gt; [1] -1.1320214  0.2577176  1.9462173  1.8134445  0.9640490  3.0214490  2.5213080</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true"></a><span class="co">#&gt; [8]  3.0062925  1.5852854</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true"></a><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">4</span>))</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true"></a>grid<span class="op">$</span>y &lt;-<span class="st"> </span>y</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true"></a><span class="kw">plot</span>(grid[<span class="st">&#39;y&#39;</span>])</span></code></pre></div>
<p><img src="data:image/png;base64,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" style="display: block; margin: auto;" /></p>
<p>To calculate the spatial lag for the first unit, we would first get the weights from the first row of the matrix <code>A</code>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a>A &lt;-<span class="st"> </span><span class="kw">shape2mat</span>(grid, <span class="dt">method =</span> <span class="st">&#39;rook&#39;</span>, <span class="dt">quiet =</span> <span class="ot">TRUE</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true"></a>w1 =<span class="st"> </span>A[<span class="dv">1</span>,]</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true"></a><span class="kw">print</span>( w1 )</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true"></a><span class="co">#&gt; [1] FALSE  TRUE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE</span></span></code></pre></div>
<p>(Notice: R treats logical values the same as zeroes and ones.)</p>
<p>To find the spatially lagged value of <code>y[1]</code>, we first multiple all <code>y</code> values by the appropriate weights, then sum:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true"></a>w1_y &lt;-<span class="st"> </span>w1 <span class="op">*</span><span class="st"> </span>y</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true"></a><span class="kw">sum</span>( w1_y )</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true"></a><span class="co">#&gt; [1] 2.071162</span></span></code></pre></div>
<p>We can do this more quicly as a matrix-vector product:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true"></a>w1 <span class="op">%*%</span><span class="st"> </span>y</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true"></a><span class="co">#&gt;          [,1]</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true"></a><span class="co">#&gt; [1,] 2.071162</span></span></code></pre></div>
<p>To get the spatial lag of each <code>y</code> value, we do the same for every row:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true"></a>A <span class="op">%*%</span><span class="st"> </span>y</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true"></a><span class="co">#&gt; 9 x 1 Matrix of class &quot;dgeMatrix&quot;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true"></a><span class="co">#&gt;           [,1]</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true"></a><span class="co">#&gt;  [1,] 2.071162</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true"></a><span class="co">#&gt;  [2,] 1.778245</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true"></a><span class="co">#&gt;  [3,] 3.279167</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true"></a><span class="co">#&gt;  [4,] 2.353336</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true"></a><span class="co">#&gt;  [5,] 8.098904</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true"></a><span class="co">#&gt;  [6,] 4.495552</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true"></a><span class="co">#&gt;  [7,] 4.819737</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true"></a><span class="co">#&gt;  [8,] 5.070642</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true"></a><span class="co">#&gt;  [9,] 6.027741</span></span></code></pre></div>
<p>To get the average surrounding value, we would use the row-standardized matrix:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true"></a>W <span class="op">%*%</span><span class="st"> </span>y</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true"></a><span class="co">#&gt; 9 x 1 Matrix of class &quot;dgeMatrix&quot;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true"></a><span class="co">#&gt;            [,1]</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true"></a><span class="co">#&gt;  [1,] 1.0355811</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true"></a><span class="co">#&gt;  [2,] 0.5927483</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true"></a><span class="co">#&gt;  [3,] 1.6395833</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true"></a><span class="co">#&gt;  [4,] 0.7844452</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true"></a><span class="co">#&gt;  [5,] 2.0247259</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true"></a><span class="co">#&gt;  [6,] 1.4985173</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true"></a><span class="co">#&gt;  [7,] 2.4098685</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true"></a><span class="co">#&gt;  [8,] 1.6902142</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true"></a><span class="co">#&gt;  [9,] 3.0138707</span></span></code></pre></div>
<p>Spatial connectivity matrices and spatial lags are used in many geostan functions, including for exploratory spatial data analysis (ESDA) and spatial-statistical modeling. For more, you can see the ESDA vignette (find it by running <code>browseVignettes(&#39;geostan&#39;)</code>).</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
